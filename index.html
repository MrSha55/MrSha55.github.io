<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR.js - WebAR</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #popup {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 50%;
        background-color: white;
        opacity: 0.9;
        transition: transform 0.3s;
        transform: translateY(100%);
        display: none;
      }
      #indicator {
        width: 20%;
        display: block;
        margin: 10px auto;
      }
    </style>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
  </head>
  <body>
    <a-scene embedded arjs="sourceType: webcam;">
      <a-assets>
        <a-asset-item id="model1" src="others/212.gltf"></a-asset-item>
      </a-assets>
      <a-marker id="marker" type="pattern" url="others/m3.patt">
        <a-entity
          gltf-model="#model1"
          scale="1 1 1"
          position="0 0 0"
          rotation="0 0 0"
        ></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <div id="popup">
      <img id="indicator" src="others/2.jpg" />
      <!-- 在这里添加弹窗的其他内容 -->
    </div>

    <script>
  
    let popup = document.getElementById("popup");
    let indicator = document.getElementById("indicator");
    let marker = document.getElementById("marker");
    let startY = 0;
    let initialTransformY = 0;
    let startTime = 0;
    let endTime = 0;
    let velocityThreshold = 0.1; // 可以调整这个值来改变速度阈值

    function touchStart(event) {
      startTime = new Date().getTime(); // 记录触摸开始时间
      startY = event.touches[0].clientY;
      initialTransformY = parseFloat(popup.style.transform.match(/translateY\((.*?)%\)/)[1]);
    }

    function touchMove(event) {
      let deltaY = event.touches[0].clientY - startY;
      let newTransformY = initialTransformY + deltaY / window.innerHeight * 100;

      if (newTransformY > 0 && newTransformY < 80) {
        popup.style.transform = `translateY(${newTransformY}%)`;
      }
    }

    function touchEnd() {
      let currentTransformY = parseFloat(popup.style.transform.match(/translateY\((.*?)%\)/)[1]);
      endTime = new Date().getTime(); // 记录触摸结束时间

      let timeElapsed = endTime - startTime; // 计算触摸持续时间（毫秒）
      let deltaY = parseFloat(popup.style.transform.match(/translateY\((.*?)%\)/)[1]) - initialTransformY;
      let velocity = Math.abs(deltaY) / timeElapsed; // 计算滑动速度（相对百分比/毫秒）

      // 如果速度超过阈值，根据滑动方向判断是否展开或收缩弹窗
      if (velocity > velocityThreshold) {
        if (deltaY > 0) {
          popup.style.transform = "translateY(80%)";
        } else {
          popup.style.transform = "translateY(0%)";
        }
      } else {
        // 原有的触摸结束逻辑
        if (currentTransformY > 30) {
          if (currentTransformY < 5) {
            popup.style.transform = "translateY(0%)";
          } else {
            popup.style.transform = "translateY(80%)";
          }
        } else {
          if (currentTransformY < 65) {
            popup.style.transform = "translateY(0%)";
          } else {
            popup.style.transform = "translateY(80%)";
          }
        }
      }
}

document.addEventListener("DOMContentLoaded", function () {
    marker.addEventListener("markerFound", () => {
      popup.style.display = "block";
      setTimeout(() => {
        popup.style.transform = "translateY(0)";
      }, 100);
      popup.addEventListener("touchstart", touchStart);
      popup.addEventListener("touchmove", touchMove);
      popup.addEventListener("touchend", touchEnd);
    });

    marker.addEventListener("markerLost", () => {
      popup.style.transform = "translateY(100%)";
      setTimeout(() => {
        popup.style.display = "none";
      }, 300);
      popup.removeEventListener("touchstart", touchStart);
      popup.removeEventListener("touchmove", touchMove);
      popup.removeEventListener("touchend", touchEnd);
    });
  });
</script>

  </body>
</html>
